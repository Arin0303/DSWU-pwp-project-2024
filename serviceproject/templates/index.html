<!DOCTYPE html>
<html>
<head>
    <title>장소 검색 및 중간지점 계산</title>

    <!-- 카카오맵 API 불러오기 -->
    <script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey={{ kakao_api_key }}"></script>
</head>
<body>
    <h1>장소 검색 및 중간지점 계산</h1>

    {% if midpoint_lat and midpoint_lon %}
        <h1>{{ cities }}의 중간지점</h1>
        <p>중간지점은 다음과 같습니다:</p>
        <p>위도: {{ midpoint_lat }}</p>
        <p>경도: {{ midpoint_lon }}</p>
    {% else %}
        <p>도시를 입력해주세요.</p>
    {% endif %}

    <!-- 장소 입력 폼 -->
    <form method="POST">
        {% csrf_token %}
        <label for="locations">장소 입력 (쉼표로 구분):</label>
        <input type="text" id="locations" name="locations" placeholder="예: 서울, 부산, 대구" required>
        <button type="submit">중간지점 계산</button>
    </form>

    <hr>

    <!-- 중간 지점 계산 결과 출력 -->
    {% if error %}
        <p>{{ error }}</p>
    {% else %}
        <h2>검색된 장소들</h2>
        <ul>
            {% for place in places %}
                <li>
                    <strong>{{ place.place_name }}</strong><br>
                    {{ place.address_name }}<br>
                    <a href="https://map.kakao.com/link/to/{{ place.place_name }},{{ place.y }},{{ place.x }}" target="_blank">지도에서 보기</a>
                </li>
            {% endfor %}
        </ul>

        <h2>중간 지점</h2>
        <p>{{ midpoint_text }}</p>  <!-- 중간 지점의 주소 출력 -->

        <div id="map" style="width:100%; height:400px;"></div>
        <script type="text/javascript">
            // 지도 초기화
            var container = document.getElementById('map');
            var options = {
                center: new kakao.maps.LatLng({{ midpoint.lat }}, {{ midpoint.lng }}), // 중간 지점
                level: 7
            };

            var map = new kakao.maps.Map(container, options);

            // 검색된 장소들에 마커 추가
            {% for place in places %}
                var markerPosition = new kakao.maps.LatLng({{ place.y }}, {{ place.x }});
                var marker = new kakao.maps.Marker({
                    position: markerPosition,
                    title: "{{ place.place_name }}"
                });
                marker.setMap(map);
            {% endfor %}

            // 중간 지점에 마커 추가
            var midpointMarker = new kakao.maps.Marker({
                position: new kakao.maps.LatLng({{ midpoint.lat }}, {{ midpoint.lng }}),
                title: "중간 지점"
            });
            midpointMarker.setMap(map);
        </script>
    {% endif %}
</body>
</html>
